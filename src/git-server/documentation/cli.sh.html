<!DOCTYPE html>
<html>
<head>
  <title>cli.sh</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="doc-style.css" />
  <script src="doc-filelist.js"></script>
  <script>
    var relativeDir = "", thisFile = "cli.sh", defaultSidebar = true;
  </script>
  <script src="doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>cli.sh</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="c">#!/usr/bin/env node</span>
// Generated by CoffeeScript 1.6.1
/*
  This is the CLI interface <span class="k">for </span>using git-server.
*/

var CLI, EventEmitter, GITCLI, GitServer, Table, async, commander, fs, getUserHomeDir, logging, mkdirp, path, repoDB, repoLocation, repoPort, repos, _c, _g,
  <span class="nv">_this</span> <span class="o">=</span> this,
  <span class="nv">__hasProp</span> <span class="o">=</span> <span class="o">{}</span>.hasOwnProperty,
  <span class="nv">__extends</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span>child, parent<span class="o">)</span> <span class="o">{</span> <span class="k">for</span> <span class="o">(</span>var key in parent<span class="o">)</span> <span class="o">{</span> <span class="k">if</span> <span class="o">(</span>__hasProp.call<span class="o">(</span>parent, key<span class="o">))</span> child<span class="o">[</span>key<span class="o">]</span> <span class="o">=</span> parent<span class="o">[</span>key<span class="o">]</span>; <span class="o">}</span> <span class="k">function </span>ctor<span class="o">()</span> <span class="o">{</span> this.constructor <span class="o">=</span> child; <span class="o">}</span> ctor.prototype <span class="o">=</span> parent.prototype; child.prototype <span class="o">=</span> new ctor<span class="o">()</span>; child.__super__ <span class="o">=</span> parent.prototype; <span class="k">return </span>child; <span class="o">}</span>;

<span class="nv">EventEmitter</span> <span class="o">=</span> require<span class="o">(</span><span class="s1">&#39;events&#39;</span><span class="o">)</span>.EventEmitter;

<span class="nv">CLI</span> <span class="o">=</span> require<span class="o">(</span><span class="s1">&#39;cli-listener&#39;</span><span class="o">)</span>;

<span class="nv">GitServer</span> <span class="o">=</span> require<span class="o">(</span><span class="s1">&#39;./host.js&#39;</span><span class="o">)</span>;

<span class="nv">mkdirp</span> <span class="o">=</span> require<span class="o">(</span><span class="s1">&#39;mkdirp&#39;</span><span class="o">)</span>;

<span class="nv">fs</span> <span class="o">=</span> require<span class="o">(</span><span class="s1">&#39;fs&#39;</span><span class="o">)</span>;

<span class="nv">async</span> <span class="o">=</span> require<span class="o">(</span><span class="s1">&#39;async&#39;</span><span class="o">)</span>;

<span class="nv">path</span> <span class="o">=</span> require<span class="o">(</span><span class="s1">&#39;path&#39;</span><span class="o">)</span>;

<span class="nv">Table</span> <span class="o">=</span> require<span class="o">(</span><span class="s1">&#39;cli-table&#39;</span><span class="o">)</span>;

<span class="nv">commander</span> <span class="o">=</span> require<span class="o">(</span><span class="s1">&#39;commander&#39;</span><span class="o">)</span>;

commander.version<span class="o">(</span><span class="s1">&#39;0.0.1&#39;</span><span class="o">)</span>.option<span class="o">(</span><span class="s1">&#39;-p, --port [value]&#39;</span>, <span class="s1">&#39;Port to run Git on&#39;</span>, parseInt<span class="o">)</span>.option<span class="o">(</span><span class="s1">&#39;-d, --directory [value]&#39;</span>, <span class="s1">&#39;Directory of the repos&#39;</span><span class="o">)</span>.option<span class="o">(</span><span class="s1">&#39;-l, --logging&#39;</span>, <span class="s1">&#39;Verbose logging on or off&#39;</span><span class="o">)</span>.parse<span class="o">(</span>process.argv<span class="o">)</span>;

<span class="nv">repoPort</span> <span class="o">=</span> commander.port <span class="o">||</span> 7000;

<span class="nv">logging</span> <span class="o">=</span> commander.logging <span class="o">||</span> <span class="nb">false</span>;

<span class="nv">getUserHomeDir</span> <span class="o">=</span> <span class="k">function</span><span class="o">()</span> <span class="o">{</span>
  var dir;
  <span class="k">if</span> <span class="o">(</span>process.platform <span class="o">===</span> <span class="s1">&#39;win32&#39;</span><span class="o">)</span> <span class="o">{</span>
    <span class="nv">dir</span> <span class="o">=</span> <span class="s1">&#39;USERPROFILE&#39;</span>;
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="nv">dir</span> <span class="o">=</span> <span class="s1">&#39;HOME&#39;</span>;
  <span class="o">}</span>
  <span class="k">return </span>process.env<span class="o">[</span>dir<span class="o">]</span>;
<span class="o">}</span>;

<span class="nv">repoLocation</span> <span class="o">=</span> commander.directory <span class="o">||</span> path.join<span class="o">(</span>getUserHomeDir<span class="o">()</span>, <span class="s1">&#39;./git-server/repos&#39;</span><span class="o">)</span>;

<span class="k">if</span> <span class="o">(</span>commander.directory !<span class="o">==</span> void 0<span class="o">)</span> <span class="o">{</span>
  <span class="nv">repoDB</span> <span class="o">=</span> commander.directory + <span class="s1">&#39;.db&#39;</span>;
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="nv">repoDB</span> <span class="o">=</span> path.join<span class="o">(</span>getUserHomeDir<span class="o">()</span>, <span class="s1">&#39;./git-server/repos.db&#39;</span><span class="o">)</span>;
<span class="o">}</span>

mkdirp.sync<span class="o">(</span>repoLocation<span class="o">)</span>;

<span class="k">if</span> <span class="o">(</span>fs.existsSync<span class="o">(</span>repoDB<span class="o">))</span> <span class="o">{</span>
  <span class="nv">repos</span> <span class="o">=</span> JSON.parse<span class="o">(</span>fs.readFileSync<span class="o">(</span>repoDB<span class="o">))</span>;
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="nv">repos</span> <span class="o">=</span> <span class="o">{</span>
    repos: <span class="o">[]</span>,
    users: <span class="o">[]</span>
  <span class="o">}</span>;
<span class="o">}</span>

<span class="nv">GITCLI</span> <span class="o">=</span> <span class="o">(</span><span class="k">function</span><span class="o">(</span>_super<span class="o">)</span> <span class="o">{</span>

  __extends<span class="o">(</span>GITCLI, _super<span class="o">)</span>;

  /*
      Constructor <span class="k">for </span>the CLI interface
      @param <span class="o">{</span>Object<span class="o">}</span> gitServer Git-Server object instance
      @param <span class="o">{</span>Array<span class="o">}</span> users Users we are managing
  */


  <span class="k">function </span>GITCLI<span class="o">(</span>gitServer, users<span class="o">)</span> <span class="o">{</span>
    var availableCalls, welcomeMessage,
      <span class="nv">_this</span> <span class="o">=</span> this;
    this.gitServer <span class="o">=</span> gitServer;
    this.users <span class="o">=</span> users !<span class="o">=</span> null ? users : <span class="o">[]</span>;
    this.saveConfig <span class="o">=</span> <span class="k">function</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return </span>GITCLI.prototype.saveConfig.apply<span class="o">(</span>_this, arguments<span class="o">)</span>;
    <span class="o">}</span>;
    this.listRepos <span class="o">=</span> <span class="k">function</span><span class="o">(</span>callback<span class="o">)</span> <span class="o">{</span>
      <span class="k">return </span>GITCLI.prototype.listRepos.apply<span class="o">(</span>_this, arguments<span class="o">)</span>;
    <span class="o">}</span>;
    this.listUsers <span class="o">=</span> <span class="k">function</span><span class="o">(</span>callback<span class="o">)</span> <span class="o">{</span>
      <span class="k">return </span>GITCLI.prototype.listUsers.apply<span class="o">(</span>_this, arguments<span class="o">)</span>;
    <span class="o">}</span>;
    this.columnPercentage <span class="o">=</span> <span class="k">function</span><span class="o">(</span>percentage<span class="o">)</span> <span class="o">{</span>
      <span class="k">return </span>GITCLI.prototype.columnPercentage.apply<span class="o">(</span>_this, arguments<span class="o">)</span>;
    <span class="o">}</span>;
    this.getUser <span class="o">=</span> <span class="k">function</span><span class="o">(</span>username<span class="o">)</span> <span class="o">{</span>
      <span class="k">return </span>GITCLI.prototype.getUser.apply<span class="o">(</span>_this, arguments<span class="o">)</span>;
    <span class="o">}</span>;
    this.addUserToRepo <span class="o">=</span> <span class="k">function</span><span class="o">(</span>callback<span class="o">)</span> <span class="o">{</span>
      <span class="k">return </span>GITCLI.prototype.addUserToRepo.apply<span class="o">(</span>_this, arguments<span class="o">)</span>;
    <span class="o">}</span>;
    this.createUser <span class="o">=</span> <span class="k">function</span><span class="o">(</span>callback<span class="o">)</span> <span class="o">{</span>
      <span class="k">return </span>GITCLI.prototype.createUser.apply<span class="o">(</span>_this, arguments<span class="o">)</span>;
    <span class="o">}</span>;
    this.createRepo <span class="o">=</span> <span class="k">function</span><span class="o">(</span>callback<span class="o">)</span> <span class="o">{</span>
      <span class="k">return </span>GITCLI.prototype.createRepo.apply<span class="o">(</span>_this, arguments<span class="o">)</span>;
    <span class="o">}</span>;
    <span class="nv">availableCalls</span> <span class="o">=</span> <span class="o">{</span>
      <span class="s1">&#39;create repo&#39;</span>: this.createRepo,
      <span class="s1">&#39;create user&#39;</span>: this.createUser,
      <span class="s1">&#39;list repos&#39;</span>: this.listRepos,
      <span class="s1">&#39;list users&#39;</span>: this.listUsers,
      <span class="s1">&#39;add user to repo&#39;</span>: this.addUserToRepo
    <span class="o">}</span>;
    <span class="nv">welcomeMessage</span> <span class="o">=</span> <span class="s2">&quot;Welcome to Git Server - Powered by NodeJS\n - Repo Location:  &quot;</span> + repoLocation + <span class="s2">&quot;\n - Listening Port:  &quot;</span> + repoPort + <span class="s2">&quot;\n - Repo Count: &quot;</span> + this.gitServer.repos.length + <span class="s2">&quot;\n - User Count: &quot;</span> + this.users.length;
    this.cli <span class="o">=</span> new CLI<span class="o">(</span><span class="s1">&#39;git-server&#39;</span>, welcomeMessage, availableCalls<span class="o">)</span>;
    this.on<span class="o">(</span><span class="s1">&#39;changedData&#39;</span>, this.saveConfig<span class="o">)</span>;
  <span class="o">}</span>

  GITCLI.prototype.createRepo <span class="o">=</span> <span class="k">function</span><span class="o">(</span>callback<span class="o">)</span> <span class="o">{</span>
    var <span class="nv">_this</span> <span class="o">=</span> this;
    <span class="k">return </span>this.cli.ask<span class="o">({</span>
      name: <span class="s1">&#39;Repo Name: &#39;</span>,
      anonRead: <span class="s1">&#39;Anonymous Access? [y,N] :: &#39;</span>
    <span class="o">}</span>, <span class="k">function</span><span class="o">(</span>err, results<span class="o">)</span> <span class="o">{</span>
      var anon, name;
      <span class="k">if</span> <span class="o">(</span>err<span class="o">)</span> <span class="o">{</span>
        throw err;
      <span class="o">}</span>
      <span class="nv">name</span> <span class="o">=</span> results.name.toLowerCase<span class="o">()</span>;
      <span class="nv">anon</span> <span class="o">=</span> results.anonRead.toLowerCase<span class="o">()</span>;
      <span class="k">if</span> <span class="o">(</span><span class="nv">anon</span> <span class="o">===</span> <span class="s1">&#39;y&#39;</span><span class="o">)</span> <span class="o">{</span>
        <span class="nv">anon</span> <span class="o">=</span> <span class="nb">true</span>;
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="nv">anon</span> <span class="o">=</span> <span class="nb">false</span>;
      <span class="o">}</span>
      _this.gitServer.createRepo<span class="o">({</span>
        name: name,
        anonRead: anon,
        users: <span class="o">[]</span>
      <span class="o">})</span>;
      _this.emit<span class="o">(</span><span class="s1">&#39;changedData&#39;</span><span class="o">)</span>;
      <span class="k">return </span>callback<span class="o">()</span>;
    <span class="o">})</span>;
  <span class="o">}</span>;

  GITCLI.prototype.createUser <span class="o">=</span> <span class="k">function</span><span class="o">(</span>callback<span class="o">)</span> <span class="o">{</span>
    var <span class="nv">_this</span> <span class="o">=</span> this;
    <span class="k">return </span>this.cli.ask<span class="o">({</span>
      username: <span class="s1">&#39;Users username: &#39;</span>,
      password: <span class="s1">&#39;Users password: &#39;</span>
    <span class="o">}</span>, <span class="k">function</span><span class="o">(</span>err, answers<span class="o">)</span> <span class="o">{</span>
      var user, username;
      <span class="k">if</span> <span class="o">(</span>err<span class="o">)</span> <span class="o">{</span>
        throw err;
      <span class="o">}</span>
      <span class="nv">username</span> <span class="o">=</span> answers.username.toLowerCase<span class="o">()</span>;
      <span class="nv">user</span> <span class="o">=</span> _this.getUser<span class="o">(</span>username<span class="o">)</span>;
      <span class="k">if</span> <span class="o">(</span>user !<span class="o">==</span> <span class="nb">false</span><span class="o">)</span> <span class="o">{</span>
        console.log<span class="o">(</span><span class="s1">&#39;This username already exists&#39;</span><span class="o">)</span>;
        <span class="k">return </span>callback<span class="o">()</span>;
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="nv">user</span> <span class="o">=</span> <span class="o">{</span>
          username: username,
          password: answers.password
        <span class="o">}</span>;
        _this.users.push<span class="o">(</span>user<span class="o">)</span>;
        _this.emit<span class="o">(</span><span class="s1">&#39;changedData&#39;</span><span class="o">)</span>;
        <span class="k">return </span>callback<span class="o">()</span>;
      <span class="o">}</span>
    <span class="o">})</span>;
  <span class="o">}</span>;

  GITCLI.prototype.addUserToRepo <span class="o">=</span> <span class="k">function</span><span class="o">(</span>callback<span class="o">)</span> <span class="o">{</span>
    var <span class="nv">_this</span> <span class="o">=</span> this;
    <span class="k">return </span>this.cli.ask<span class="o">({</span>
      repoName: <span class="s1">&#39;Repo Name: &#39;</span>,
      username: <span class="s1">&#39;Users username: &#39;</span>,
      permissions: <span class="s1">&#39;Permissions (comma seperated: R,W ): &#39;</span>
    <span class="o">}</span>, <span class="k">function</span><span class="o">(</span>err, answers<span class="o">)</span> <span class="o">{</span>
      var permissions, repo, repoName, user, username;
      <span class="nv">repoName</span> <span class="o">=</span> answers.repoName.toLowerCase<span class="o">()</span>;
      <span class="nv">username</span> <span class="o">=</span> answers.username.toLowerCase<span class="o">()</span>;
      <span class="nv">repo</span> <span class="o">=</span> _this.gitServer.getRepo<span class="o">(</span>repoName + <span class="s1">&#39;.git&#39;</span><span class="o">)</span>;
      <span class="nv">user</span> <span class="o">=</span> _this.getUser<span class="o">(</span>username<span class="o">)</span>;
      <span class="nv">permissions</span> <span class="o">=</span> answers.permissions.split<span class="o">(</span><span class="s1">&#39;,&#39;</span><span class="o">)</span>;
      <span class="k">if</span> <span class="o">(</span>permissions.length <span class="o">===</span> 0<span class="o">)</span> <span class="o">{</span>
        <span class="nv">permissions</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;R&#39;</span><span class="o">]</span>;
      <span class="o">}</span>
      <span class="k">if</span> <span class="o">(</span><span class="nv">repo</span> <span class="o">===</span> <span class="nb">false</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return </span>console.log<span class="o">(</span><span class="s1">&#39;Repo doesnt exist.&#39;</span><span class="o">)</span>;
      <span class="o">}</span> <span class="k">else if</span> <span class="o">(</span><span class="nv">user</span> <span class="o">===</span> <span class="nb">false</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return </span>console.log<span class="o">(</span><span class="s1">&#39;User doesnt exist.&#39;</span><span class="o">)</span>;
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        repo.users.push<span class="o">({</span>
          user: user,
          permissions: permissions
        <span class="o">})</span>;
        _this.emit<span class="o">(</span><span class="s1">&#39;changedData&#39;</span><span class="o">)</span>;
        <span class="k">return </span>callback<span class="o">()</span>;
      <span class="o">}</span>
    <span class="o">})</span>;
  <span class="o">}</span>;

  /*
      Loop through and find this user
      @param <span class="o">{</span>String<span class="o">}</span> username Username of the user we are looking <span class="k">for</span>
  */


  GITCLI.prototype.getUser <span class="o">=</span> <span class="k">function</span><span class="o">(</span>username<span class="o">)</span> <span class="o">{</span>
    var user, _i, _len, _ref;
    <span class="nv">_ref</span> <span class="o">=</span> this.users;
    <span class="k">for</span> <span class="o">(</span><span class="nv">_i</span> <span class="o">=</span> 0, <span class="nv">_len</span> <span class="o">=</span> _ref.length; _i &lt; _len; _i++<span class="o">)</span> <span class="o">{</span>
      <span class="nv">user</span> <span class="o">=</span> _ref<span class="o">[</span>_i<span class="o">]</span>;
      <span class="k">if</span> <span class="o">(</span>user.username <span class="o">===</span> username<span class="o">)</span> <span class="o">{</span>
        <span class="k">return </span>user;
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return </span><span class="nb">false</span>;
  <span class="o">}</span>;

  /*
      Get the number of columns needed from a % width
      @param <span class="o">{</span>Int<span class="o">}</span> percentage Percentage of the console width
  */


  GITCLI.prototype.columnPercentage <span class="o">=</span> <span class="k">function</span><span class="o">(</span>percentage<span class="o">)</span> <span class="o">{</span>
    <span class="k">return </span>Math.floor<span class="o">(</span>process.stdout.columns * <span class="o">(</span>percentage / 100<span class="o">))</span>;
  <span class="o">}</span>;

  GITCLI.prototype.listUsers <span class="o">=</span> <span class="k">function</span><span class="o">(</span>callback<span class="o">)</span> <span class="o">{</span>
    var repo, repoUser, table, user, users, _i, _j, _k, _l, _len, _len1, _len2, _len3, _ref, _ref1, _ref2, _ref3;
    <span class="nv">users</span> <span class="o">=</span> this.users;
    <span class="nv">_ref</span> <span class="o">=</span> this.users;
    <span class="k">for</span> <span class="o">(</span><span class="nv">_i</span> <span class="o">=</span> 0, <span class="nv">_len</span> <span class="o">=</span> _ref.length; _i &lt; _len; _i++<span class="o">)</span> <span class="o">{</span>
      <span class="nv">user</span> <span class="o">=</span> _ref<span class="o">[</span>_i<span class="o">]</span>;
      user.repos <span class="o">=</span> <span class="o">[]</span>;
      <span class="nv">_ref1</span> <span class="o">=</span> this.gitServer.repos;
      <span class="k">for</span> <span class="o">(</span><span class="nv">_j</span> <span class="o">=</span> 0, <span class="nv">_len1</span> <span class="o">=</span> _ref1.length; _j &lt; _len1; _j++<span class="o">)</span> <span class="o">{</span>
        <span class="nv">repo</span> <span class="o">=</span> _ref1<span class="o">[</span>_j<span class="o">]</span>;
        <span class="nv">_ref2</span> <span class="o">=</span> repo.users;
        <span class="k">for</span> <span class="o">(</span><span class="nv">_k</span> <span class="o">=</span> 0, <span class="nv">_len2</span> <span class="o">=</span> _ref2.length; _k &lt; _len2; _k++<span class="o">)</span> <span class="o">{</span>
          <span class="nv">repoUser</span> <span class="o">=</span> _ref2<span class="o">[</span>_k<span class="o">]</span>;
          <span class="k">if</span> <span class="o">(</span>repoUser.user.username <span class="o">===</span> user.username<span class="o">)</span> <span class="o">{</span>
            user.repos.push<span class="o">({</span>
              name: repo.name,
              permissions: repoUser.permissions
            <span class="o">})</span>;
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="nv">table</span> <span class="o">=</span> new Table<span class="o">({</span>
      head: <span class="o">[</span><span class="s1">&#39;Username&#39;</span>, <span class="s1">&#39;Password&#39;</span>, <span class="s1">&#39;Repos&#39;</span><span class="o">]</span>,
      colWidths: <span class="o">[</span>this.columnPercentage<span class="o">(</span>40<span class="o">)</span> - 1, this.columnPercentage<span class="o">(</span>20<span class="o">)</span> - 1, this.columnPercentage<span class="o">(</span>40<span class="o">)</span> - 1<span class="o">]</span>
    <span class="o">})</span>;
    <span class="nv">_ref3</span> <span class="o">=</span> this.users;
    <span class="k">for</span> <span class="o">(</span><span class="nv">_l</span> <span class="o">=</span> 0, <span class="nv">_len3</span> <span class="o">=</span> _ref3.length; _l &lt; _len3; _l++<span class="o">)</span> <span class="o">{</span>
      <span class="nv">user</span> <span class="o">=</span> _ref3<span class="o">[</span>_l<span class="o">]</span>;
      <span class="nv">repos</span> <span class="o">=</span> <span class="o">(</span><span class="k">function</span><span class="o">()</span> <span class="o">{</span>
        var _len4, _m, _ref4, _results;
        <span class="nv">_ref4</span> <span class="o">=</span> user.repos;
        <span class="nv">_results</span> <span class="o">=</span> <span class="o">[]</span>;
        <span class="k">for</span> <span class="o">(</span><span class="nv">_m</span> <span class="o">=</span> 0, <span class="nv">_len4</span> <span class="o">=</span> _ref4.length; _m &lt; _len4; _m++<span class="o">)</span> <span class="o">{</span>
          <span class="nv">repo</span> <span class="o">=</span> _ref4<span class="o">[</span>_m<span class="o">]</span>;
          _results.push<span class="o">(</span><span class="s2">&quot;&quot;</span> + repo.name + <span class="s2">&quot; (&quot;</span> + <span class="o">(</span>repo.permissions.join<span class="o">(</span><span class="s1">&#39;,&#39;</span><span class="o">))</span> + <span class="s2">&quot;)&quot;</span><span class="o">)</span>;
        <span class="o">}</span>
        <span class="k">return </span>_results;
      <span class="o">})()</span>;
      table.push<span class="o">([</span>user.username, user.password, repos.join<span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">)])</span>;
    <span class="o">}</span>
    console.log<span class="o">(</span>table.toString<span class="o">())</span>;
    <span class="k">return </span>callback<span class="o">()</span>;
  <span class="o">}</span>;

  GITCLI.prototype.listRepos <span class="o">=</span> <span class="k">function</span><span class="o">(</span>callback<span class="o">)</span> <span class="o">{</span>
    var repo, table, user, users, _i, _len;
    <span class="nv">repos</span> <span class="o">=</span> this.gitServer.repos;
    <span class="nv">table</span> <span class="o">=</span> new Table<span class="o">({</span>
      head: <span class="o">[</span><span class="s1">&#39;Repo Name&#39;</span>, <span class="s1">&#39;Anonymous Reads&#39;</span>, <span class="s1">&#39;Users&#39;</span><span class="o">]</span>,
      colWidths: <span class="o">[</span>this.columnPercentage<span class="o">(</span>40<span class="o">)</span> - 1, this.columnPercentage<span class="o">(</span>20<span class="o">)</span> - 1, this.columnPercentage<span class="o">(</span>40<span class="o">)</span> - 1<span class="o">]</span>
    <span class="o">})</span>;
    <span class="k">for</span> <span class="o">(</span><span class="nv">_i</span> <span class="o">=</span> 0, <span class="nv">_len</span> <span class="o">=</span> repos.length; _i &lt; _len; _i++<span class="o">)</span> <span class="o">{</span>
      <span class="nv">repo</span> <span class="o">=</span> repos<span class="o">[</span>_i<span class="o">]</span>;
      <span class="nv">users</span> <span class="o">=</span> <span class="o">(</span><span class="k">function</span><span class="o">()</span> <span class="o">{</span>
        var _j, _len1, _ref, _results;
        <span class="nv">_ref</span> <span class="o">=</span> repo.users;
        <span class="nv">_results</span> <span class="o">=</span> <span class="o">[]</span>;
        <span class="k">for</span> <span class="o">(</span><span class="nv">_j</span> <span class="o">=</span> 0, <span class="nv">_len1</span> <span class="o">=</span> _ref.length; _j &lt; _len1; _j++<span class="o">)</span> <span class="o">{</span>
          <span class="nv">user</span> <span class="o">=</span> _ref<span class="o">[</span>_j<span class="o">]</span>;
          _results.push<span class="o">(</span><span class="s2">&quot;&quot;</span> + user.user.username + <span class="s2">&quot; (&quot;</span> + <span class="o">(</span>user.permissions.join<span class="o">(</span><span class="s1">&#39;,&#39;</span><span class="o">))</span> + <span class="s2">&quot;)&quot;</span><span class="o">)</span>;
        <span class="o">}</span>
        <span class="k">return </span>_results;
      <span class="o">})()</span>;
      table.push<span class="o">([</span>repo.name, repo.anonRead, users.join<span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">)])</span>;
    <span class="o">}</span>
    console.log<span class="o">(</span>table.toString<span class="o">())</span>;
    <span class="k">return </span>callback<span class="o">()</span>;
  <span class="o">}</span>;

  GITCLI.prototype.saveConfig <span class="o">=</span> <span class="k">function</span><span class="o">()</span> <span class="o">{</span>
    var config;
    <span class="nv">config</span> <span class="o">=</span> JSON.stringify<span class="o">({</span>
      repos: this.gitServer.repos,
      users: this.users
    <span class="o">})</span>;
    <span class="k">return </span>fs.writeFileSync<span class="o">(</span>repoDB, config<span class="o">)</span>;
  <span class="o">}</span>;

  <span class="k">return </span>GITCLI;

<span class="o">})(</span>EventEmitter<span class="o">)</span>;

<span class="nv">_g</span> <span class="o">=</span> new GitServer<span class="o">(</span>repos.repos, logging, repoLocation, repoPort<span class="o">)</span>;

<span class="nv">_c</span> <span class="o">=</span> new GITCLI<span class="o">(</span>_g, repos.users<span class="o">)</span>;
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
